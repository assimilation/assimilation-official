language: minimal
dist: bionic
addons:
  apt:
    update: true
    packages:
      - cmake
      - gcc
      - python
      - doxygen
      - pkg-config
      - libglib2.0-dev
      - python-pip
      - libpcap0.8-dev
      - libsodium-dev
      - valgrind

install:
  - sudo pip install ctypesgen testify

script:
  - pwd 
  - mkdir ../root_of_binary_tree && pushd ../root_of_binary_tree
  - cmake ../assimilation-official && sudo make install
  - sudo cpack
  - docker build -t assimproj-docker-repo.bintray.io/nanoprobe:latest -f $TRAVIS_BUILD_DIR/ci/Dockerfiles/nanoprobe.dockerfile .
  - docker login -u $BINTRAY_USER -p $BINTRAY_KEY assimproj-docker-repo.bintray.io
  - docker push assimproj-docker-repo.bintray.io/nanoprobe:latest


deploy:
  on:
    branch: borgified/ubuntu
  provider: bintray
  file: $TRAVIS_BUILD_DIR/ci/bintray.json
  edge: true

after_deploy:
  - docker build -f $TRAVIS_BUILD_DIR/ci/Dockerfiles/ubuntu1804.dockerfile $TRAVIS_BUILD_DIR
